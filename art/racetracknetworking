from tealight.net import connect, send
from tealight.art import  text
from tealight.utils import now
connect("racetracktest")
text(100, 200, "This is the server! He will give you drinks!")
carNumber=0
x=0
users=[]
lastsend={}
def server_handle_message(message):
  global carNumber, users
  if "to" in message:
    to=message['to']
    if to == "server":
      if "type" in message:
        type = message['type']
        if type == "heartbeat":
           lastsend[message['user_id']] = message['payload']
        elif type == "registration":
          users.append(message['payload'])
          print users
def server_handle_frame():
  for user in users:
    if user in lastsend:
      # the user has actually sent a heartbeat
      time_now = now()
      last_send = lastsend[user]
      if (time_now - last_send > 10):
        print "user disconnect", user
        lastsend.pop(user, None)
        users.remove(user)