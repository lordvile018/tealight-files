from tealight.net import connect, send
from tealight.utils import now
connect("racetracktest")
carNumber=0
x=0
users=[]
lastsend={}
def handle_message(message):
  global carNumber, users
  if "to" in message:
    to=message['to']
    if to == "server":
      if "type" in message:
        type = message['type']
        if type == "heartbeat":
           lastsend[message['user_id']] = {"last-sent": message['payload']}
        elif type == "registration":
          users.append(message['payload'])
          print users
def handle_frame():
  for user in users:
    if user in lastsend:
      # the user has actually sent a heartbeat
      time_now = now()
      if (time_now - lastsend[user] > 10):
        print "user disconnect", user